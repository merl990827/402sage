services:
  server:
    image: ghcr.io/ptrus/verisage.xyz:latest@sha256:2e1fa01d871d249be8b19acc9d8ff934609910b9cbf20802acab82520502b491
    container_name: verisage-server
    command: ./start-server.sh
    ports:
      - "8000:8000"
    annotations:
      net.oasis.proxy.ports.8000.custom_domain: api.verisage.xyz
    environment:
      - PROCESS_TYPE=server
      - ENVIRONMENT=${ENVIRONMENT:-production}
      - DEBUG_MOCK=${DEBUG_MOCK:-false}
      - DEBUG_PAYMENTS=${DEBUG_PAYMENTS:-false}
      - CORS_ORIGINS=${CORS_ORIGINS:-http://localhost:3000}
      - X402_PAYMENT_ADDRESS=${X402_PAYMENT_ADDRESS:-}
      - X402_NETWORK=${X402_NETWORK:-base-sepolia}
      - X402_PRICE=${X402_PRICE:-$0.1}
      - CDP_API_KEY_ID=${CDP_API_KEY_ID:-}
      - CDP_API_KEY_SECRET=${CDP_API_KEY_SECRET:-}
      - FACILITATOR_URL=${FACILITATOR_URL:-}
      - DATA_DIR=/app/data
    volumes:
      - db-data:/app/data
    restart: unless-stopped
  worker:
    image: ghcr.io/ptrus/verisage.xyz:latest@sha256:2e1fa01d871d249be8b19acc9d8ff934609910b9cbf20802acab82520502b491
    container_name: verisage-worker
    command: ./start-worker.sh
    environment:
      - PROCESS_TYPE=worker
      - ENVIRONMENT=${ENVIRONMENT:-production}
      - DEBUG_MOCK=${DEBUG_MOCK:-false}
      - DEBUG_SIGNING=${DEBUG_SIGNING:-false}
      - CLAUDE_API_KEY=${CLAUDE_API_KEY:-}
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
      - PERPLEXITY_API_KEY=${PERPLEXITY_API_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - DATA_DIR=/app/data
    volumes:
      - /run/rofl-appd.sock:/run/rofl-appd.sock
      - db-data:/app/data
    restart: unless-stopped
volumes:
  db-data:
